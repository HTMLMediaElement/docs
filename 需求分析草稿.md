# 需求分析草稿

### 设计思路
1.选番：爬dmhy之类的rss网站 每个季度的新番列表，并自动匹配TMDB上的名称 把番剧信息做成海报墙 供我们查阅。   
2.选字幕组：你想追番了，选一部番 ，它会列出所有可选的字幕组 和相关信息（比如更新时间？）， 你选择一个字幕组点击追番
3.执行：自动你配置的路径下创建文件夹（TMDB上的名称/Season x），随后 调用qb的api配置RSS订阅规则 
4.你的播放器（比如infuse）直接监听这个文件夹 即可获得和B站追番一样的体验

---



### 技术栈：

- 客户端：？？？待定
- 前端：vue.js
- 服务端：nodejs+nginx
- 数据库：sqlite



### 问题：

- 注意多季的番剧怎么处理



### 模块划分

- **番剧数据库**：
  - 数据库：sqlite
  - 数据属性：
    - 番剧ID
    - 正确番剧名
    - 番剧别名
    - 上映时间
    - TMDB元数据？
- **A 服务端：番剧数据库基础数据获取**
  - 功能：定期拉取数据源的数据，并增量更新至数据库中
  - 数据源：https://unpkg.com/bangumi-data
- **B 服务端：正确番剧名获取**
  - 功能：使用TMDB API，获取**番剧数据库**中正确片名，并写入基础番剧数据库
  - TMDB API：https://developer.themoviedb.org/docs
  - API访问限制：50 requests per second
  - 实现方法：
    - 对于基础番剧数据库中的每一部番剧，使用TMDB的API检索片名
    - 具体检索和判定方式需要测试得到（TMDB有模糊搜索吗？）
- **C 服务端：海报墙服务器**
  - 功能：获取番剧元数据和下载源
  - 实现方法：
    - **元数据：**使用TMDB API获取番剧数据库中 大于某年份（如2022）番剧的**元数据**，缓存在**番剧数据库**中
    - **下载源：**从预先配置的各RSS源中获取各番剧可用的下载源（已经做好筛选的RSS订阅链接），缓存在**番剧数据库**中
      - 无需全部缓存，仅缓存包含符合筛选规则的下载源，如1080P、简体
      - 并按字幕组分类
  - 问题：我们的网页版海报墙包含哪些元数据合适？ 仅包含少量必须数据 如片名 简介 海报 ，并附上TMDB链接？还是？
- **D 网页端：完整用户界面**（与系统的所有交互都在网页端完成）
  - 页面：
    - 登录与鉴权（防止系统被滥用）
    - 海报墙：按各种筛选规则检索并展示历史所有番剧
    - 番剧详情页：展示特定番剧详细信息。用户可以在该页面选取下载源，并发送请求来配置本地nas的自动下载
    - 个人信息页：用于配置本地nas自动下载相关的设置
- **E 客户端：**
  - 功能：仅处理服务器发送请求（由用户在网页端发起）
  - qb的API：https://github.com/qbittorrent/qBittorrent/wiki/WebUI-API-(qBittorrent-4.1)
  - 自动重命名工具：https://github.com/Nriver/Episode-ReName
  - 鉴权：
    - 状态数据库（用于重启后恢复状态 主要是鉴权相关信息）
    - 鉴权（仅处理特定服务器发送的请求）
  - 接口（新建RSS任务）需要鉴权
    - 在本地磁盘中的特定位置创建目录结构（如 番剧名/Season 1）
    - 调用qb的API 新建RSS任务和自动下载规则，下载至上述目录中
    - 配置 下载完成自动调用工具，将文件名重命名为 S01E01的形式

